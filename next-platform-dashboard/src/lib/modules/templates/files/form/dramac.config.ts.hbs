import { defineModule } from '@dramac/sdk';

export default defineModule({
  id: '{{moduleId}}',
  name: '{{moduleName}}',
  version: '1.0.0',
  description: 'Form builder with validation and submission handling',
  icon: 'FileEdit',
  category: 'utility',
  type: 'app',

  entry: {
    dashboard: './src/Dashboard.tsx',
    settings: './src/Settings.tsx',
  },

  database: {
    tables: [
      {
        name: 'form_submissions',
        columns: [
          { name: 'id', type: 'uuid', primaryKey: true },
          { name: 'site_id', type: 'uuid', nullable: false },
          { name: 'agency_id', type: 'uuid', nullable: false },
          { name: 'form_id', type: 'text', nullable: false },
          { name: 'data', type: 'jsonb', nullable: false },
          { name: 'status', type: 'text', default: "'pending'" },
          { name: 'submitted_by', type: 'text' },
          { name: 'submitted_at', type: 'timestamp', default: 'NOW()' },
          { name: 'processed_at', type: 'timestamp' }
        ],
        rls: [
          {
            name: 'site_isolation',
            operation: 'ALL',
            using: "site_id = current_setting('app.site_id')::uuid"
          }
        ]
      }
    ]
  },

  permissions: [
    { key: 'view', name: 'View Submissions', category: 'form' },
    { key: 'manage', name: 'Manage Forms', category: 'form' },
    { key: 'export', name: 'Export Data', category: 'form' }
  ],

  roles: [
    { slug: 'admin', name: 'Admin', permissions: ['*'], hierarchyLevel: 100 },
    { slug: 'editor', name: 'Editor', permissions: ['view', 'manage'], hierarchyLevel: 50 },
    { slug: 'viewer', name: 'Viewer', permissions: ['view'], hierarchyLevel: 10, isDefault: true }
  ]
});
