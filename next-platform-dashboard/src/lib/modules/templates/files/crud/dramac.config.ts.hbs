import { defineModule } from '@dramac/sdk';

export default defineModule({
  id: '{{moduleId}}',
  name: '{{moduleName}}',
  version: '1.0.0',
  description: 'Full CRUD operations with advanced features',
  icon: 'Database',
  category: 'utility',
  type: 'app',

  entry: {
    dashboard: './src/Dashboard.tsx',
    settings: './src/Settings.tsx',
  },

  database: {
    tables: [
      {
        name: '{{entityNamePlural}}',
        columns: [
          { name: 'id', type: 'uuid', primaryKey: true },
          { name: 'site_id', type: 'uuid', nullable: false },
          { name: 'agency_id', type: 'uuid', nullable: false },
          { name: 'name', type: 'text', nullable: false },
          { name: 'description', type: 'text' },
          { name: 'status', type: 'text', default: "'active'" },
          { name: 'metadata', type: 'jsonb' },
          {{#if enableSoftDelete}}
          { name: 'deleted_at', type: 'timestamp' },
          {{/if}}
          { name: 'created_by', type: 'uuid' },
          { name: 'created_at', type: 'timestamp', default: 'NOW()' },
          { name: 'updated_by', type: 'uuid' },
          { name: 'updated_at', type: 'timestamp' }
        ],
        rls: [
          {
            name: 'site_isolation',
            operation: 'ALL',
            using: "site_id = current_setting('app.site_id')::uuid"
          }
        ]
      },
      {{#if enableAudit}}
      {
        name: '{{entityNamePlural}}_audit',
        columns: [
          { name: 'id', type: 'uuid', primaryKey: true },
          { name: 'site_id', type: 'uuid', nullable: false },
          { name: 'record_id', type: 'uuid', nullable: false },
          { name: 'action', type: 'text', nullable: false },
          { name: 'changes', type: 'jsonb' },
          { name: 'performed_by', type: 'uuid' },
          { name: 'performed_at', type: 'timestamp', default: 'NOW()' }
        ],
        rls: [
          {
            name: 'site_isolation',
            operation: 'ALL',
            using: "site_id = current_setting('app.site_id')::uuid"
          }
        ]
      }
      {{/if}}
    ]
  },

  permissions: [
    { key: 'view', name: 'View {{entityNamePlural}}', category: '{{entityName}}' },
    { key: 'create', name: 'Create {{entityNamePlural}}', category: '{{entityName}}' },
    { key: 'edit', name: 'Edit {{entityNamePlural}}', category: '{{entityName}}' },
    { key: 'delete', name: 'Delete {{entityNamePlural}}', category: '{{entityName}}' },
    {{#if enableAudit}}
    { key: 'audit', name: 'View Audit Log', category: '{{entityName}}' },
    {{/if}}
    { key: 'export', name: 'Export Data', category: '{{entityName}}' }
  ],

  roles: [
    { slug: 'admin', name: 'Admin', permissions: ['*'], hierarchyLevel: 100 },
    { slug: 'editor', name: 'Editor', permissions: ['view', 'create', 'edit'], hierarchyLevel: 50 },
    { slug: 'viewer', name: 'Viewer', permissions: ['view'], hierarchyLevel: 10, isDefault: true }
  ]
});
