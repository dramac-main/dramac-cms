import { defineModule } from '@dramac/sdk';

export default defineModule({
  id: '{{moduleId}}',
  name: '{{moduleName}}',
  version: '1.0.0',
  description: 'Manage your {{itemNamePlural}}',
  icon: 'List',
  category: 'utility',
  type: 'app',

  entry: {
    dashboard: './src/Dashboard.tsx',
    settings: './src/Settings.tsx',
  },

  database: {
    tables: [
      {
        name: '{{itemNamePlural}}',
        columns: [
          { name: 'id', type: 'uuid', primaryKey: true },
          { name: 'site_id', type: 'uuid', nullable: false },
          { name: 'agency_id', type: 'uuid', nullable: false },
          {{#each fieldNames}}
          { name: '{{this}}', type: 'text' },
          {{/each}}
          { name: 'created_by', type: 'uuid' },
          { name: 'created_at', type: 'timestamp', default: 'NOW()' },
          { name: 'updated_at', type: 'timestamp' }
        ],
        rls: [
          {
            name: 'site_isolation',
            operation: 'ALL',
            using: "site_id = current_setting('app.site_id')::uuid"
          }
        ]
      }
    ]
  },

  permissions: [
    { key: 'view', name: 'View {{itemNamePlural}}', category: '{{itemName}}' },
    { key: 'create', name: 'Create {{itemNamePlural}}', category: '{{itemName}}' },
    { key: 'edit', name: 'Edit {{itemNamePlural}}', category: '{{itemName}}' },
    { key: 'delete', name: 'Delete {{itemNamePlural}}', category: '{{itemName}}' }
  ],

  roles: [
    { slug: 'admin', name: 'Admin', permissions: ['*'], hierarchyLevel: 100 },
    { slug: 'editor', name: 'Editor', permissions: ['view', 'create', 'edit'], hierarchyLevel: 50 },
    { slug: 'viewer', name: 'Viewer', permissions: ['view'], hierarchyLevel: 10, isDefault: true }
  ]
});
